<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Veer Mahadev Plastic | Wholesale E-commerce</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { scroll-behavior: smooth; }
    @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    .animate-marquee { display: inline-block; animation: marquee 15s linear infinite; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="bg-red-900 text-white text-xs sm:text-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 flex flex-wrap items-center justify-between gap-2">
      <p>Welcome to Veer Mahadev Plastic - Wholesale Disposable Supplier</p>
      <div class="flex items-center gap-3">
        <a href="https://www.instagram.com/veermahadevplastic.in/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 underline hover:text-red-100" aria-label="Instagram">Instagram</a>
        <a href="https://www.youtube.com/@veermahadevplastic" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 underline hover:text-red-100" aria-label="YouTube">YouTube</a>
      </div>
    </div>
  </div>

  <header class="sticky top-0 z-50 bg-white border-b border-red-100 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
      <div class="flex flex-wrap lg:flex-nowrap items-center gap-3">
        <a href="#" class="flex items-center gap-3 min-w-max">
          <div class="h-11 w-11 rounded-full bg-red-700 text-white font-extrabold grid place-content-center">VM</div>
          <div>
            <p class="font-extrabold text-red-700 leading-tight text-base sm:text-lg">VEER MAHADEV PLASTIC</p>
            <p class="text-xs text-gray-500">Premium Disposable Products</p>
          </div>
        </a>

        <div class="w-full lg:flex-1 lg:w-auto order-3 lg:order-none">
          <div class="flex items-center rounded-md border border-red-200 overflow-hidden bg-white">
            <select id="searchCategory" class="hidden sm:block text-sm border-r border-red-100 px-3 py-2.5 bg-red-50 text-gray-700 outline-none">
              <option value="All">All Categories</option>
              <option value="Disposable Cups">Disposable Cups</option>
              <option value="Plates">Plates</option>
              <option value="Containers">Containers</option>
              <option value="Best Offer For The Day">Best Offer For The Day</option>
            </select>
            <input id="searchInput" type="text" placeholder="Search products by name, category, pack size" class="flex-1 px-3 py-2.5 text-sm outline-none" aria-label="Search products" />
            <button id="searchBtn" class="px-4 py-2.5 bg-red-700 hover:bg-red-800 text-white text-sm font-semibold">Search</button>
          </div>
        </div>

        <button id="userAuthBtn" class="w-full sm:w-auto px-4 py-2.5 rounded-md bg-red-700 hover:bg-red-800 text-white text-sm font-bold text-center order-4 lg:order-none">Login</button>
      </div>

      <nav class="mt-3 flex flex-wrap items-center gap-2 text-sm font-semibold text-gray-700">
        <a href="#home" class="px-3 py-1.5 rounded hover:bg-red-50 hover:text-red-700">Home</a>
        <a href="#categories" class="px-3 py-1.5 rounded hover:bg-red-50 hover:text-red-700">Categories</a>
        <a href="#products" class="px-3 py-1.5 rounded hover:bg-red-50 hover:text-red-700">Products</a>
        <a href="#why-us" class="px-3 py-1.5 rounded hover:bg-red-50 hover:text-red-700">Why Us</a>
        <a href="#footer" class="px-3 py-1.5 rounded hover:bg-red-50 hover:text-red-700">Contact</a>
        <button id="adminOpenBtn" class="hidden px-3 py-1.5 rounded bg-black text-white hover:bg-gray-800">Admin Panel</button>
      </nav>
    </div>
  </header>

  <section id="home" class="relative">
    <img src="https://i.postimg.cc/pXSCyWZX/BACKGROUND_IMAGE.png?auto=format&fit=crop&w=1800&q=80" alt="Marriage themed hero background" class="absolute inset-0 w-full h-full object-cover" />
    <div class="absolute inset-0 bg-gradient-to-r from-red-950/90 via-red-900/75 to-red-700/60"></div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 sm:py-24 lg:py-28 text-white">
      <span class="inline-block px-3 py-1 rounded-full bg-white/20 border border-white/20 text-xs sm:text-sm font-semibold mb-4">Marriage & Event Disposable Specialist</span>
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold max-w-3xl leading-tight">Professional Disposable Product Range for Weddings, Catering, and Bulk Supply</h1>
      <p class="mt-4 text-red-50 max-w-2xl text-sm sm:text-base">From premium compartment plates to food-grade containers and cups, we deliver consistent wholesale quality for your business.</p>
      <div class="mt-7 flex flex-wrap gap-3">
        <a href="#products" class="px-5 py-3 rounded-md bg-white text-red-700 font-bold text-sm sm:text-base hover:bg-red-50">Explore Products</a>
        <button class="order-now-global px-5 py-3 rounded-md border border-white/40 bg-white/10 text-white font-bold text-sm sm:text-base hover:bg-white/20">Order on WhatsApp</button>
      </div>
    </div>
  </section>

  <div class="bg-yellow-400 py-2 overflow-hidden border-y-2 border-red-600">
    <div class="whitespace-nowrap animate-marquee flex items-center">
      <span class="text-red-700 font-bold text-lg mx-10">ðŸ”¥ SPECIAL MARRIAGE COMBO: FULL SET ONLY @ BEST PRICE ðŸ”¥</span>
      <span class="text-red-700 font-bold text-lg mx-10">ðŸšš WHOLESALE DELIVERY ALL OVER AHMEDABAD</span>
      <span class="text-red-700 font-bold text-lg mx-10">ðŸ“ž CALL NOW: +91 80503 89261</span>
      <span class="text-red-700 font-bold text-lg mx-10">âœ¨ PREMIUM BIODEGRADABLE QUALITY âœ¨</span>
    </div>
  </div>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <section id="categories" class="mb-8">
      <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
        <h2 class="text-2xl sm:text-3xl font-extrabold">Shop by Category</h2>
        <p class="text-sm text-gray-500">Grid architecture can scale for 50+ products easily.</p>
      </div>
      <div id="categoryButtons" class="flex flex-wrap gap-2"></div>
    </section>

    <section id="products">
      <div class="mb-4 flex items-center justify-between gap-2">
        <h3 class="text-xl font-bold">Product Catalog</h3>
        <div class="text-right">
          <p id="productCount" class="text-sm text-gray-600"></p>
          <p id="searchStatus" class="text-xs text-red-700 font-semibold"></p>
        </div>
      </div>
      <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>
    </section>

    <section id="why-us" class="mt-14">
      <h3 class="text-2xl font-extrabold mb-5">Why Choose Veer Mahadev Plastic?</h3>
      <div class="grid md:grid-cols-3 gap-4">
        <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm"><p class="font-bold text-red-700 mb-1">Reliable Wholesale Pricing</p><p class="text-sm text-gray-600">Competitive rates designed for retailers, caterers, and event suppliers.</p></div>
        <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm"><p class="font-bold text-red-700 mb-1">Hygienic & Quality Focus</p><p class="text-sm text-gray-600">Consistent material quality and practical pack sizes for business needs.</p></div>
        <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm"><p class="font-bold text-red-700 mb-1">Fast WhatsApp Ordering</p><p class="text-sm text-gray-600">One click inquiry with pre-filled product details to speed up responses.</p></div>
      </div>
    </section>
  </main>

  <section id="productDetailModal" class="fixed inset-0 z-[100] hidden">
    <div id="productDetailOverlay" class="absolute inset-0 bg-black/50"></div>
    <div class="relative mx-auto mt-10 w-[92%] max-w-3xl rounded-xl bg-white shadow-2xl">
      <div class="flex items-center justify-between border-b border-gray-100 p-4">
        <h4 class="text-lg font-extrabold text-red-700">Product Details</h4>
        <button id="closeDetailModal" class="rounded-md bg-gray-100 px-3 py-1.5 text-sm font-semibold hover:bg-gray-200">Close</button>
      </div>
      <div class="grid gap-4 p-4 md:grid-cols-2 md:p-6">
        <img id="detailImage" src="" alt="Product image" class="h-64 w-full rounded-lg object-cover border border-red-100" />
        <div>
          <p id="detailCategory" class="inline-flex rounded bg-red-50 px-2 py-1 text-xs font-semibold text-red-700"></p>
          <h5 id="detailName" class="mt-2 text-2xl font-extrabold"></h5>
          <p id="detailPack" class="mt-2 text-sm text-gray-600"></p>
          <p id="detailPrice" class="mt-2 text-lg font-extrabold text-red-700"></p>
          <p id="detailDescription" class="mt-3 text-sm leading-6 text-gray-700"></p>
          <button id="detailWhatsappBtn" class="mt-5 inline-flex w-full justify-center rounded-md bg-green-600 px-4 py-2.5 text-sm font-bold text-white hover:bg-green-700">Order on WhatsApp</button>
        </div>
      </div>
    </div>
  </section>

  <div id="loginModal" class="fixed inset-0 z-[130] hidden">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="relative mx-auto mt-20 w-[92%] max-w-md rounded-xl bg-white p-5 shadow-2xl">
      <div class="flex items-center justify-between mb-3"><h4 class="text-xl font-bold text-red-700">Login Required</h4><button id="closeLoginModal" class="text-sm bg-gray-100 px-3 py-1 rounded">Close</button></div>
      <p class="text-sm text-gray-600 mb-3">Order karne ke liye email login jaruri hai.</p>
      <input id="loginEmail" type="email" placeholder="Enter email" class="w-full border rounded px-3 py-2 mb-2" />
      <input id="loginPassword" type="password" placeholder="Enter password" class="w-full border rounded px-3 py-2 mb-3" />
      <button id="loginSubmitBtn" class="w-full bg-red-700 text-white rounded px-4 py-2 font-semibold">Login</button>
      <p id="loginError" class="text-xs text-red-700 mt-2"></p>
    </div>
  </div>

  <div id="adminModal" class="fixed inset-0 z-[140] hidden">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative mx-auto mt-8 w-[94%] max-w-2xl rounded-xl bg-white p-5 shadow-2xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-4"><h4 class="text-xl font-extrabold">Owner Admin Panel</h4><button id="closeAdminModal" class="text-sm bg-gray-100 px-3 py-1 rounded">Close</button></div>
      <p class="text-xs text-gray-500 mb-3">Only owner can see this panel. Add products without changing code every time.</p>
      <div class="grid md:grid-cols-2 gap-3">
        <input id="adminName" class="border rounded px-3 py-2" placeholder="Product Name" />
        <input id="adminPack" class="border rounded px-3 py-2" placeholder="Pack Size (e.g. 25 Pcs Pack)" />
        <input id="adminPrice" class="border rounded px-3 py-2" placeholder="Wholesale Price (keep empty if needed)" />
        <select id="adminCategory" class="border rounded px-3 py-2"><option>Plates</option><option>Disposable Cups</option><option>Containers</option><option>Best Offer For The Day</option></select>
        <input id="adminImage" class="border rounded px-3 py-2 md:col-span-2" placeholder="Image URL" value="https://via.placeholder.com/300" />
        <textarea id="adminDescription" class="border rounded px-3 py-2 md:col-span-2" placeholder="Description"></textarea>
      </div>
      <button id="adminAddProduct" class="mt-3 bg-black text-white rounded px-4 py-2">Add Product</button>
      <h5 class="font-bold mt-5 mb-2">Custom Added Products</h5>
      <div id="adminProductList" class="space-y-2"></div>
    </div>
  </div>

  <!-- AI Bot -->
  <div id="aiBotWidget" class="fixed bottom-4 right-4 z-[120]">
    <button id="aiBotToggle" class="h-14 w-14 rounded-full bg-red-700 text-white shadow-xl hover:bg-red-800" aria-label="Open AI Bot">ðŸ¤–</button>
    <div id="aiBotPanel" class="hidden mt-3 w-[92vw] max-w-sm overflow-hidden rounded-xl border border-red-100 bg-white shadow-2xl">
      <div class="flex items-center justify-between bg-red-700 px-4 py-3 text-white"><p class="font-bold">Veer AI Assistant</p><button id="aiBotClose" class="rounded bg-white/20 px-2 py-1 text-xs">Close</button></div>
      <div id="aiBotMessages" class="h-72 space-y-3 overflow-y-auto p-3 text-sm"><div class="rounded-lg bg-red-50 p-2 text-gray-800">Namaste! Main Veer AI Bot hu. Aap product, pack size, best offers, ya WhatsApp order ke baare me pooch sakte ho.</div></div>
      <div class="border-t border-gray-100 p-3"><div class="flex gap-2"><input id="aiBotInput" type="text" placeholder="Type your question..." class="w-full rounded-md border border-red-200 px-3 py-2 text-sm outline-none" /><button id="aiBotSend" class="rounded-md bg-red-700 px-3 py-2 text-sm font-semibold text-white">Send</button></div><a href="https://wa.me/918050389261" target="_blank" rel="noopener noreferrer" class="mt-2 inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-xs font-bold text-white hover:bg-green-700">Talk to Human on WhatsApp</a></div>
    </div>
  </div>

  <footer id="footer" class="bg-white border-t border-red-100 mt-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 grid md:grid-cols-3 gap-8 text-sm">
      <div><h4 class="text-base font-extrabold text-red-700 mb-2">Veer Mahadev Plastic</h4><p class="text-gray-600">Your trusted partner for disposable cups, plates, and containers in wholesale quantities.</p></div>
      <div><h4 class="text-base font-extrabold mb-2">Trust Factors</h4><p class="text-gray-700">GST: <span class="font-semibold">24BLLPL0402N1Z6</span></p><p class="text-gray-700">MSME: <span class="font-semibold">UDYAM-GJ-01-0532946</span></p></div>
      <div><h4 class="text-base font-extrabold mb-2">Connect</h4><div class="flex items-center gap-4"><a href="https://www.instagram.com/veermahadevplastic.in/" target="_blank" rel="noopener noreferrer" class="text-red-700 font-semibold hover:text-red-800">Instagram</a><a href="https://www.youtube.com/@veermahadevplastic" target="_blank" rel="noopener noreferrer" class="text-red-700 font-semibold hover:text-red-800">YouTube</a></div></div>
    </div>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAnalytics, isSupported as analyticsSupported } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-analytics.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGfZVese3tqFf_Uw_pJUQbSR5p6sohRmo",
      authDomain: "veermahadev--codes.firebaseapp.com",
      projectId: "veermahadev--codes",
      storageBucket: "veermahadev--codes.firebasestorage.app",
      messagingSenderId: "380308449387",
      appId: "1:380308449387:web:964942c3eb82a4c742292e",
      measurementId: "G-R2DHXNS9TF"
    };

    const app = initializeApp(firebaseConfig);
    analyticsSupported().then((ok) => { if (ok) getAnalytics(app); });
    const auth = getAuth(app);
    const db = getFirestore(app);

    const WHATSAPP_NUMBER = '918050389261';
    const OWNER_EMAIL = 'owner@veermahadev.in';
    const OWNER_PASSWORD = 'Mr.karankumar_7';

    const baseProducts = [
      { name: '4-Compartment Plate', pack: '25 Pcs Pack', price: 'â‚¹', category: 'Plates', image: 'https://via.placeholder.com/300', description: 'Heavy-duty multi-compartment serving plate ideal for weddings and catered events.' },
      { name: 'Round Buffet Plate', pack: '50 Pcs Pack', price: 'â‚¹', category: 'Plates', image: 'https://via.placeholder.com/300', description: 'Classic buffet plate for large events and banquet-style setups.' },
      { name: 'Tea Cup 150ml', pack: '100 Pcs Pack', price: 'â‚¹', category: 'Disposable Cups', image: 'https://via.placeholder.com/300', description: 'Lightweight and hygienic cups suitable for tea service and stalls.' },
      { name: 'Food Container 500ml', pack: '25 Pcs Pack', price: 'â‚¹', category: 'Containers', image: 'https://via.placeholder.com/300', description: 'Compact takeaway container for curries and meals.' },
      { name: 'Family Meal Combo Pack', pack: '30 Pcs Pack', price: 'â‚¹', category: 'Best Offer For The Day', image: 'https://via.placeholder.com/300', description: 'Best combo offer for events with mixed utility products.' }
    ];

    const categories = ['All', 'Disposable Cups', 'Plates', 'Containers', 'Best Offer For The Day'];
    let activeCategory = 'All';
    let searchQuery = '';
    let pendingOrderProduct = null;
    let currentUser = null;
    let firestoreProducts = [];
    let productsMode = 'firestore';

    const getLocalProducts = () => {
      try {
        return JSON.parse(localStorage.getItem('vmLocalProducts') || '[]');
      } catch {
        return [];
      }
    };
    const saveLocalProducts = (items) => localStorage.setItem('vmLocalProducts', JSON.stringify(items));

    const getAllProducts = () => [...baseProducts, ...(productsMode === 'firestore' ? firestoreProducts : getLocalProducts())];

    const categoryButtons = document.getElementById('categoryButtons');
    const productGrid = document.getElementById('productGrid');
    const productCount = document.getElementById('productCount');
    const searchStatus = document.getElementById('searchStatus');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const searchCategory = document.getElementById('searchCategory');

    const productDetailModal = document.getElementById('productDetailModal');
    const closeDetailModal = document.getElementById('closeDetailModal');
    const productDetailOverlay = document.getElementById('productDetailOverlay');
    const detailImage = document.getElementById('detailImage');
    const detailCategory = document.getElementById('detailCategory');
    const detailName = document.getElementById('detailName');
    const detailPack = document.getElementById('detailPack');
    const detailPrice = document.getElementById('detailPrice');
    const detailDescription = document.getElementById('detailDescription');
    const detailWhatsappBtn = document.getElementById('detailWhatsappBtn');

    const loginModal = document.getElementById('loginModal');
    const closeLoginModal = document.getElementById('closeLoginModal');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const loginSubmitBtn = document.getElementById('loginSubmitBtn');
    const loginError = document.getElementById('loginError');
    const userAuthBtn = document.getElementById('userAuthBtn');
    const adminOpenBtn = document.getElementById('adminOpenBtn');

    const adminModal = document.getElementById('adminModal');
    const closeAdminModal = document.getElementById('closeAdminModal');
    const adminAddProduct = document.getElementById('adminAddProduct');
    const adminProductList = document.getElementById('adminProductList');

    const aiBotToggle = document.getElementById('aiBotToggle');
    const aiBotPanel = document.getElementById('aiBotPanel');
    const aiBotClose = document.getElementById('aiBotClose');
    const aiBotMessages = document.getElementById('aiBotMessages');
    const aiBotInput = document.getElementById('aiBotInput');
    const aiBotSend = document.getElementById('aiBotSend');

    const getFallbackUser = () => {
      try {
        return JSON.parse(localStorage.getItem('vmFallbackUser') || 'null');
      } catch {
        return null;
      }
    };

    const isLoggedIn = () => !!currentUser;
    const isOwner = () => currentUser?.email === OWNER_EMAIL;

    function updateAuthUI() {
      userAuthBtn.textContent = currentUser ? `Logout (${currentUser.email})` : 'Login';
      adminOpenBtn.classList.toggle('hidden', !isOwner());
    }

    function openLogin(reasonProduct = null) {
      pendingOrderProduct = reasonProduct;
      loginError.textContent = '';
      loginModal.classList.remove('hidden');
    }
    function closeLogin() { loginModal.classList.add('hidden'); }

    function completeOrderFlow(productName = null) {
      const name = productName || 'products from website';
      const message = `Hi Veer Mahadev Plastic, I want to inquire about ${name} shown on your website.`;
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
    }

    function gateOrder(productName = null) {
      if (!isLoggedIn()) {
        openLogin(productName);
        return;
      }
      completeOrderFlow(productName);
    }

    function getFilteredProducts() {
      const normalizedQuery = searchQuery.trim().toLowerCase();
      return getAllProducts().filter((product) => {
        const byCategoryButtons = activeCategory === 'All' || product.category === activeCategory;
        const bySearchCategory = searchCategory.value === 'All' || product.category === searchCategory.value;
        const haystack = `${product.name} ${product.category} ${product.pack} ${product.price}`.toLowerCase();
        const byQuery = !normalizedQuery || haystack.includes(normalizedQuery);
        return byCategoryButtons && bySearchCategory && byQuery;
      });
    }

    function renderCategories() {
      categoryButtons.innerHTML = categories.map((category) => {
        const isActive = activeCategory === category;
        return `<button data-category="${category}" class="category-btn px-4 py-2 rounded-md text-sm font-semibold border transition ${isActive ? 'bg-red-700 border-red-700 text-white' : 'bg-white border-red-200 text-red-700 hover:bg-red-50'}">${category}</button>`;
      }).join('');
      document.querySelectorAll('.category-btn').forEach((button) => button.addEventListener('click', () => {
        activeCategory = button.dataset.category;
        renderCategories();
        renderProducts();
      }));
    }

    function openProductDetail(index) {
      const product = getFilteredProducts()[index];
      if (!product) return;
      detailImage.src = product.image;
      detailImage.alt = product.name;
      detailCategory.textContent = product.category;
      detailName.textContent = product.name;
      detailPack.textContent = `Pack Size: ${product.pack}`;
      detailPrice.textContent = `Wholesale Price: ${product.price || ''}`;
      detailDescription.textContent = product.description;
      detailWhatsappBtn.onclick = () => gateOrder(product.name);
      productDetailModal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
    }

    function closeProductDetail() {
      productDetailModal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }

    function renderProducts() {
      const filtered = getFilteredProducts();
      productCount.textContent = `${filtered.length} product(s) showing`;
      searchStatus.textContent = searchQuery.trim() ? `Search: "${searchQuery.trim()}"` : '';
      if (!filtered.length) {
        productGrid.innerHTML = '<div class="col-span-full rounded-lg border border-red-100 bg-white p-8 text-center text-gray-600">No products found. Try a different search keyword.</div>';
        return;
      }
      productGrid.innerHTML = filtered.map((product, index) => `
        <article class="bg-white rounded-xl border border-red-100 overflow-hidden shadow-sm hover:shadow-lg hover:-translate-y-1 transition">
          <img src="${product.image}" alt="${product.name}" class="w-full h-44 object-cover" />
          <div class="p-4">
            <span class="inline-flex text-xs font-semibold bg-red-50 text-red-700 px-2 py-1 rounded mb-2">${product.category}</span>
            <h4 class="font-bold text-lg leading-snug">${product.name}</h4>
            <p class="text-sm text-gray-600 mt-1">${product.pack}</p>
            <p class="text-red-700 font-extrabold mt-3">Wholesale Price: ${product.price || ''}</p>
            <div class="mt-4 grid grid-cols-1 gap-2">
              <button data-index="${index}" class="detail-btn inline-flex w-full justify-center items-center rounded-md border border-red-600 text-red-700 hover:bg-red-50 font-bold text-sm px-4 py-2.5">View Product Details</button>
              <button data-product="${product.name}" class="order-btn inline-flex w-full justify-center items-center rounded-md bg-green-600 hover:bg-green-700 text-white font-bold text-sm px-4 py-2.5">Order on WhatsApp</button>
            </div>
          </div>
        </article>`).join('');

      document.querySelectorAll('.detail-btn').forEach((btn) => btn.addEventListener('click', () => openProductDetail(Number(btn.dataset.index))));
      document.querySelectorAll('.order-btn').forEach((btn) => btn.addEventListener('click', () => gateOrder(btn.dataset.product)));
    }

    function runSearch() { searchQuery = searchInput.value; renderProducts(); }

    function renderAdminProducts() {
      const sourceItems = productsMode === 'firestore'
        ? firestoreProducts
        : getLocalProducts().map((item, index) => ({ ...item, id: String(index) }));

      adminProductList.innerHTML = sourceItems.map((p) => `<div class="flex justify-between items-center rounded border p-2 text-sm"><span>${p.name} (${p.category})</span><button data-remove="${p.id}" class="text-red-700 font-semibold">Delete</button></div>`).join('') || '<p class="text-sm text-gray-500">No custom products yet.</p>';

      adminProductList.querySelectorAll('button[data-remove]').forEach((btn) => btn.addEventListener('click', async () => {
        if (productsMode === 'firestore') {
          try {
            await deleteDoc(doc(db, 'products', btn.dataset.remove));
          } catch (err) {
            alert('Delete failed: ' + (err.message || err));
          }
          return;
        }

        const localItems = getLocalProducts();
        localItems.splice(Number(btn.dataset.remove), 1);
        saveLocalProducts(localItems);
        renderAdminProducts();
        renderProducts();
      }));
    }

    function appendBotMessage(text, role = 'bot') {
      const bubble = document.createElement('div');
      bubble.className = role === 'user' ? 'ml-auto max-w-[85%] rounded-lg bg-red-700 p-2 text-white' : 'max-w-[85%] rounded-lg bg-red-50 p-2 text-gray-800';
      bubble.textContent = text;
      aiBotMessages.appendChild(bubble);
      aiBotMessages.scrollTop = aiBotMessages.scrollHeight;
    }
    function getAiReply(input) {
      const q = input.toLowerCase();
      if (q.includes('login')) return 'Order karne ke liye pehle login karna jaruri hai.';
      if (q.includes('best offer') || q.includes('combo')) return 'Best Offer For The Day category me combo packs available hain.';
      if (q.includes('whatsapp') || q.includes('order')) return 'Har product card me Order on WhatsApp button hai, login ke baad active hoga.';
      return 'Main aapki help ke liye hu. Category, combo offer, pack size, ya order process puch sakte ho.';
    }
    function sendAiMessage() {
      const userText = aiBotInput.value.trim();
      if (!userText) return;
      appendBotMessage(userText, 'user'); aiBotInput.value = '';
      setTimeout(() => appendBotMessage(getAiReply(userText)), 250);
    }

    // listeners
    searchBtn.addEventListener('click', runSearch);
    searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') runSearch(); });
    searchCategory.addEventListener('change', renderProducts);

    closeDetailModal.addEventListener('click', closeProductDetail);
    productDetailOverlay.addEventListener('click', closeProductDetail);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeProductDetail(); });

    document.querySelectorAll('.order-now-global').forEach((btn) => btn.addEventListener('click', () => gateOrder('products from homepage')));

    userAuthBtn.addEventListener('click', async () => {
      if (isLoggedIn()) {
        if (currentUser?.uid) {
          await signOut(auth);
        }
        localStorage.removeItem('vmFallbackUser');
        currentUser = null;
        updateAuthUI();
      } else {
        openLogin();
      }
    });

    loginSubmitBtn.addEventListener('click', async () => {
      const email = loginEmail.value.trim();
      const pass = loginPassword.value.trim();
      if (!email || !pass) { loginError.textContent = 'Email and password required.'; return; }
      loginError.textContent = '';
      try {
        await signInWithEmailAndPassword(auth, email, pass);
      } catch (err) {
        const code = err?.code || '';
        const useFallback = ['auth/configuration-not-found', 'auth/operation-not-allowed', 'auth/network-request-failed'].includes(code);

        if (!useFallback) {
          loginError.textContent = err.message || 'Login failed';
          return;
        }

        if (email === OWNER_EMAIL && pass !== OWNER_PASSWORD) {
          loginError.textContent = 'Owner password incorrect.';
          return;
        }

        const fallbackUser = { email, isFallback: true };
        localStorage.setItem('vmFallbackUser', JSON.stringify(fallbackUser));
        currentUser = fallbackUser;
      }

      closeLogin();
      updateAuthUI();
      if (pendingOrderProduct) {
        const p = pendingOrderProduct;
        pendingOrderProduct = null;
        completeOrderFlow(p);
      }
    });
    closeLoginModal.addEventListener('click', closeLogin);

    onAuthStateChanged(auth, (user) => {
      currentUser = user || getFallbackUser();
      updateAuthUI();
    });

    adminOpenBtn.addEventListener('click', () => {
      if (!isOwner()) return;
      adminModal.classList.remove('hidden');
      renderAdminProducts();
    });
    closeAdminModal.addEventListener('click', () => adminModal.classList.add('hidden'));

    adminAddProduct.addEventListener('click', async () => {
      const name = document.getElementById('adminName').value.trim();
      const pack = document.getElementById('adminPack').value.trim();
      const price = document.getElementById('adminPrice').value.trim();
      const category = document.getElementById('adminCategory').value;
      const image = document.getElementById('adminImage').value.trim() || 'https://via.placeholder.com/300';
      const description = document.getElementById('adminDescription').value.trim() || 'Custom product added by owner.';
      if (!name || !pack) return;
      try {
        if (productsMode === 'firestore') {
          await addDoc(collection(db, 'products'), { name, pack, price, category, image, description, createdAt: serverTimestamp() });
        } else {
          const localItems = getLocalProducts();
          localItems.push({ name, pack, price, category, image, description });
          saveLocalProducts(localItems);
          renderProducts();
          renderAdminProducts();
        }
        ['adminName','adminPack','adminPrice','adminDescription'].forEach((id) => document.getElementById(id).value = '');
        document.getElementById('adminImage').value = 'https://via.placeholder.com/300';
      } catch (err) {
        alert('Add failed: ' + (err.message || err));
      }
    });

    aiBotToggle.addEventListener('click', () => aiBotPanel.classList.toggle('hidden'));
    aiBotClose.addEventListener('click', () => aiBotPanel.classList.add('hidden'));
    aiBotSend.addEventListener('click', sendAiMessage);
    aiBotInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') sendAiMessage(); });

    // Firestore realtime products (global)
    const productsRef = collection(db, 'products');
    const productsQuery = query(productsRef, orderBy('createdAt', 'desc'));
    onSnapshot(productsQuery, (snapshot) => {
      productsMode = 'firestore';
      firestoreProducts = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
      renderProducts();
      renderAdminProducts();
    }, (err) => {
      productsMode = 'local';
      console.error('Firestore listener error:', err);
      renderProducts();
      renderAdminProducts();
    });

    // init
    renderCategories();
    renderProducts();
    updateAuthUI();
  </script>
</body>
</html>
